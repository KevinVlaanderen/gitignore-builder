#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'gitignores'
require 'gitignores/version'
require 'gitignores/exceptions'

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do |*ignores|
    opts = {
      :ignores_dir => options['use-directory'],
      :update_ignores => options['update'],
      :out => STDOUT
    }
    begin
      Gitignores.main(ignores, opts)
    rescue Gitignores::GitignoreNotFoundException => e
      puts "Couldn't find ignore \"#{e.ignore_name}\""
    end
  end

  options['use-directory'] = ENV['HOME'] + '/.gitignores'
  on("-d ignore-repository", "--use-directory", "The directory in which to store the github/gitignore directory")
  on("--update", "Update the github/gitignore repository")

  arg :ignores, :many

  description Gitignores::DESCRIPTION

  version Gitignores::VERSION

  use_log_level_option

  go!
end
